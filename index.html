<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Willian & Sara | Confirma√ß√£o</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
      :root {
        --cor-primaria: #0A4F3A;
        --cor-primaria-hover: #073a2b;
        --cor-recusar: #D93025;
        --cor-texto-principal: #333333;
        --cor-texto-secundario: #666666;
        --cor-borda: #E0E0E0;
        --cor-texto-branco: #FFFFFF; 
        --cor-fundo-card: rgba(255, 255, 255, 0.95);
      }
      
      * { box-sizing: border-box; }

      body {
        font-family: 'Montserrat', sans-serif;
        margin: 0; padding: 20px;
        color: var(--cor-texto-branco);
        display: flex; align-items: center; justify-content: center;
        min-height: 100vh; 
        background-image: linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.4)), 
                          url('https://i.imgur.com/8Sq1suX.jpeg');
        background-size: cover;
        background-position: center;
        background-attachment: fixed; 
        text-shadow: 0 2px 4px rgba(0,0,0,0.6);
        overflow-x: hidden; /* Evita rolagem lateral */
      }

      #app {
        width: 100%; max-width: 480px;
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(3px);
        -webkit-backdrop-filter: blur(3px);
        padding: 30px; 
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        display: flex;
        flex-direction: column;
        height: 85vh; 
        border: 1px solid rgba(255, 255, 255, 0.1);
      }
      
      @media (max-width: 480px) {
        body { padding: 0; align-items: flex-start; }
        #app {
          max-width: none; width: 100%; height: 100dvh; 
          border-radius: 0; margin: 0; box-shadow: none;
          padding: 20px; border: none;
          background: rgba(0, 0, 0, 0.3); 
        }
      }

      .header { text-align: center; padding-bottom: 15px; border-bottom: 1px solid rgba(255,255,255,0.2); margin-bottom: 15px; flex-shrink: 0; }
      .header h1 { margin: 0; font-size: 24px; font-weight: 700; color: #FFF; letter-spacing: 1px; }
      .header p { margin: 5px 0 0; font-size: 13px; color: #EEE; text-transform: uppercase; letter-spacing: 2px; }

      #conteudo-ativo, #telaSucesso, #painelAdmin { width: 100%; display: flex; flex-direction: column; flex-grow: 1; overflow: hidden; }

      #listaConvidados { display: none; flex-direction: column; flex-grow: 1; overflow: hidden; height: 100%; }
      #nomesContainer {
        flex-grow: 1; overflow-y: auto; padding-right: 5px; margin-bottom: 15px;
        scrollbar-width: thin; scrollbar-color: rgba(255,255,255,0.5) transparent;
      }

      /* --- PAINEL ADMIN --- */
      #painelAdmin { display: none; }
      .dashboard-grid {
        display: grid; grid-template-columns: 1fr 1fr; gap: 10px;
        overflow-y: auto; padding-bottom: 20px; scrollbar-width: none; 
      }
      .stat-card {
        background: var(--cor-fundo-card); padding: 15px; border-radius: 12px;
        text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.2); text-shadow: none;
        display: flex; flex-direction: column; justify-content: center;
      }
      .stat-card.full-width { grid-column: span 2; background: rgba(255, 255, 255, 0.9); }
      .stat-card.destaque { border: 2px solid var(--cor-primaria); }
      .stat-titulo { font-size: 11px; text-transform: uppercase; color: #666; margin-bottom: 5px; font-weight: 700; }
      .stat-valor { font-size: 28px; font-weight: 800; color: #333; line-height: 1; }
      .stat-obs { font-size: 10px; color: #888; margin-top: 5px; }
      .c-verde { color: var(--cor-primaria); } .c-vermelho { color: var(--cor-recusar); } .c-azul { color: #0056b3; }
      
      /* --- INPUTS E BOTOES --- */
      input[type="text"] {
        width: 100%; padding: 15px;
        border: 1px solid rgba(255,255,255,0.5);
        background: rgba(255,255,255,0.9);
        color: #000; border-radius: 8px; font-size: 18px;
        text-align: center; font-weight: 700; text-transform: uppercase;
        margin-bottom: 15px; text-shadow: none;
      }
      button {
        width: 100%; padding: 16px;
        background-color: var(--cor-primaria);
        color: white; border: none; border-radius: 8px;
        font-size: 16px; font-weight: 700; text-transform: uppercase;
        cursor: pointer; transition: transform 0.1s;
        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        text-shadow: none; flex-shrink: 0; margin-top: auto;
      }
      button:active { transform: scale(0.98); }
      button.secondary { background-color: #555; margin-top: 10px; }

      /* CARDS CONVIDADOS */
      .convidado-item { background: var(--cor-fundo-card); border-radius: 10px; padding: 15px; margin-bottom: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-shadow: none; }
      .convidado-item:last-child { margin-bottom: 5px; }
      .convidado-item p.nome { margin: 0 0 5px; color: #333; font-weight: 700; font-size: 16px; }
      .convidado-item .info-extra { font-size: 12px; color: #666; margin-bottom: 10px; display: flex; align-items: center; gap: 5px; flex-wrap: wrap; }
      .radio-group { display: flex; background: #EEE; border-radius: 8px; padding: 3px; }
      .radio-group input { display: none; }
      .radio-group label { flex: 1; text-align: center; padding: 12px 5px; border-radius: 6px; font-size: 13px; font-weight: 600; color: #555; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 5px; }
      .radio-group input[value="Confirmado"]:checked + label { background: var(--cor-primaria); color: white; }
      .radio-group input[value="Recusado"]:checked + label { background: var(--cor-recusar); color: white; }

      /* --- ESTILO NOVO DO CONTADOR --- */
      #countdown-container { margin-bottom: 20px; text-align: center; flex-shrink: 0; }
      .countdown-title { font-size: 11px; text-transform: uppercase; letter-spacing: 1px; color: #FFF; margin-bottom: 8px; opacity: 0.9; }
      .countdown-footer { font-size: 11px; color: #EEE; margin-top: 8px; font-style: italic; opacity: 0.8; }
      #countdown { display: flex; justify-content: center; gap: 15px; }
      .time-block { display: flex; flex-direction: column; align-items: center; }
      .numero { font-size: 28px; font-weight: 700; line-height: 1; color: #FFF; }
      .label { font-size: 10px; text-transform: uppercase; opacity: 0.8; margin-top: 2px; }

      #loading, #mensagem { text-align: center; padding: 15px; border-radius: 8px; margin-top: 10px; font-weight: 600; text-shadow: none; }
      #loading { background: rgba(255,255,255,0.9); color: #333; }
      #mensagem { display: none; }
      #telaSucesso { text-align: center; justify-content: center; height: 100%; }
      #telaSucesso h2 { font-size: 28px; margin-bottom: 10px; color: #FFF; }
      #telaSucesso p { font-size: 16px; opacity: 0.9; }
      #telaSucesso a { color: #FFF; font-weight: 700; margin-top: 20px; display: inline-block; font-size: 18px; }

    </style>
  </head>
  <body>
    <div id="app">
      <div class="header">
        <h1>Willian & Sara</h1>
        <p>Fevereiro 2026</p>
      </div>

      <div id="conteudo-ativo">
        <div id="countdown-container">
          <div class="countdown-title">Encerramento das Confirma√ß√µes em:</div>
          <div id="countdown">
            <div class="time-block"><span id="days" class="numero">--</span><span class="label">Dias</span></div>
            <div class="time-block"><span id="hours" class="numero">--</span><span class="label">Hs</span></div>
            <div class="time-block"><span id="minutes" class="numero">--</span><span class="label">Min</span></div>
            <div class="time-block"><span id="seconds" class="numero">--</span><span class="label">Seg</span></div>
          </div>
          <div class="countdown-footer">(Prazo final: 10/01/2026)</div>
        </div>
        
        <div id="login">
          <p style="text-align:center; margin-bottom:10px; opacity:0.9; font-size:14px;">Digite o c√≥digo do convite:</p>
          <input type="text" id="codigoInput" placeholder="WS-00-00" maxlength="10" onkeyup="this.value = this.value.toUpperCase();">
          <button id="btnBuscar" onclick="buscar()">Confirmar Presen√ßa</button>
        </div>
      </div>

      <div id="listaConvidados">
        <p style="text-align:center; margin-bottom:10px; font-size:13px; opacity:0.9; flex-shrink: 0;">
          Confirme quem da fam√≠lia ir√° comparecer:
        </p>
        <div id="nomesContainer"></div>
        <button id="btnConfirmar" onclick="enviarConfirmacao()">Salvar Confirma√ß√£o</button>
      </div>

      <div id="painelAdmin">
        <p style="text-align:center; margin-bottom:15px; font-size:16px; font-weight:700;">üìä Painel de Controle</p>
        <div class="dashboard-grid">
          <div class="stat-card full-width">
            <span class="stat-titulo">Carregando dados...</span>
          </div>
        </div>
        <button class="secondary" onclick="sairAdmin()">Sair do Painel</button>
      </div>

      <div id="conteudo-encerrado" style="display:none; text-align:center; justify-content: center; height: 100%;">
        <h2 style="color:white;">Prazo Encerrado</h2>
        <p>As confirma√ß√µes pelo site est√£o fechadas.</p>
      </div>

      <div id="loading" style="display:none;">Carregando...</div>
      <div id="mensagem"></div>

      <div id="telaSucesso" style="display:none;">
        <h2>Salvo! ‚úÖ</h2>
        <p>Sua presen√ßa foi registrada.</p>
        <p><a href="#" onclick="reiniciar(event)">Sair / Outro C√≥digo</a></p>
      </div>
    </div>

    <script>
      // --- COLOQUE SUA URL AQUI ---
      const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbySc_m4-r0UiREV5certyoh4uf3QA6uM4LbttTma7R9sxAG6RijzQ8VloXqRvUrgdPu/exec"; 
      // -----------------------------

      const deadline = new Date(2026, 0, 11, 0, 0, 0).getTime();
      const fictitiousCode = "WS-02-26";

      function iniciarContador() {
        const now = new Date().getTime();
        const diff = deadline - now;
        if (diff < 0) {
          document.getElementById('conteudo-ativo').style.display = 'none';
          document.getElementById('conteudo-encerrado').style.display = 'flex';
          return;
        }
        const d = Math.floor(diff / (1000 * 60 * 60 * 24));
        const h = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const s = Math.floor((diff % (1000 * 60)) / 1000);
        const f = n => n < 10 ? '0'+n : n;
        document.getElementById('days').innerText = f(d);
        document.getElementById('hours').innerText = f(h);
        document.getElementById('minutes').innerText = f(m);
        document.getElementById('seconds').innerText = f(s);
      }
      setInterval(iniciarContador, 1000);
      iniciarContador();

      // NOVA FUN√á√ÉO DE COMUNICA√á√ÉO
      async function enviarDados(action, dados = {}) {
        const body = JSON.stringify({ action: action, ...dados });
        return fetch(SCRIPT_URL, {
          method: 'POST',
          body: body
        }).then(response => response.json());
      }

      function buscar() {
        var codigo = document.getElementById('codigoInput').value.trim().toUpperCase();
        if (!codigo) return alertMsg("Digite o c√≥digo!", true);
        if (codigo === fictitiousCode) return alertMsg("Este √© apenas um exemplo. Use o seu c√≥digo.", true);
        
        mostrarLoading(true, "Verificando...");
        document.getElementById('btnBuscar').disabled = true;
        
        enviarDados('buscar', { codigo: codigo })
          .then(r => processarLogin(r))
          .catch(e => tratarErro(e));
      }

      function processarLogin(r) {
        mostrarLoading(false);
        document.getElementById('btnBuscar').disabled = false;
        
        if (r.error) return alertMsg(r.error, true);
        if (r.isAdmin) { abrirPainelAdmin(); return; }
        mostrarListaConvidados(r.convidados);
      }

      function abrirPainelAdmin() {
        document.getElementById('conteudo-ativo').style.display = 'none';
        document.getElementById('painelAdmin').style.display = 'flex';
        mostrarLoading(true, "Calculando...");
        
        enviarDados('dashboard')
          .then(d => renderizarDashboard(d))
          .catch(e => tratarErro(e));
      }

      function renderizarDashboard(d) {
        mostrarLoading(false);
        if(d.error) return alertMsg(d.error, true);
        
        const entreguesPendentes = d.entreguesPendentes || 0;

        var html = `
          <div class="stat-card full-width destaque">
            <span class="stat-titulo">Total de Convidados</span><span class="stat-valor">${d.total}</span>
          </div>
          <div class="stat-card">
            <span class="stat-titulo">Confirmados</span><span class="stat-valor c-verde">${d.confirmados}</span>
          </div>
          <div class="stat-card">
            <span class="stat-titulo">Recusados</span><span class="stat-valor c-vermelho">${d.recusados}</span>
          </div>
          <div class="stat-card">
            <span class="stat-titulo">Pendentes</span><span class="stat-valor">${d.pendentes}</span>
          </div>
          
          <div class="stat-card" style="border:1px solid #0056b3">
             <span class="stat-titulo">Receberam (S/ Resp)</span>
             <span class="stat-valor c-azul">${entreguesPendentes}</span>
             <span class="stat-obs">Col K = "s"</span>
          </div>
          
          <div class="stat-card">
            <span class="stat-titulo">Willian</span><span class="stat-valor c-azul">${d.willian}</span>
          </div>
          <div class="stat-card">
            <span class="stat-titulo">Sara</span><span class="stat-valor c-azul">${d.sara}</span>
          </div>
          <div class="stat-card">
            <span class="stat-titulo">Dos Dois</span><span class="stat-valor c-azul">${d.ambos}</span>
          </div>
          <div class="stat-card">
            <span class="stat-titulo">Sem C√≥digo</span><span class="stat-valor c-vermelho">${d.semCodigo}</span>
            <span class="stat-obs">Col G vazia</span>
          </div>`;
        document.querySelector('.dashboard-grid').innerHTML = html;
      }

      function sairAdmin() {
        document.getElementById('painelAdmin').style.display = 'none';
        document.getElementById('conteudo-ativo').style.display = 'flex';
        document.getElementById('codigoInput').value = '';
        alertMsg("");
      }

      function mostrarListaConvidados(convidados) {
        var html = "";
        convidados.forEach(c => {
          var isConf = c.status === 'Confirmado' ? 'checked' : '';
          var isRec = c.status === 'Recusado' ? 'checked' : '';
          var grp = `rsvp_${c.linha}`;
          var extra = []; var emoji = "";
          if(c.funcao && c.funcao.match(/noiv/i)) emoji = "üíç";
          else if(c.funcao && c.funcao.match(/madrinha|padrinho/i)) emoji = "‚ú®";
          if(c.parentesco) extra.push(c.parentesco);
          if(c.funcao) extra.push(c.funcao);
          
          html += `
            <div class="convidado-item">
              <p class="nome">${c.nome} ${emoji}</p>
              ${extra.length ? `<div class="info-extra"><span>${extra.join('</span><span>')}</span></div>` : ''}
              <div class="radio-group">
                <input type="radio" name="${grp}" id="${grp}_y" value="Confirmado" data-linha="${c.linha}" ${isConf}>
                <label for="${grp}_y">‚úÖ Vou</label>
                <input type="radio" name="${grp}" id="${grp}_n" value="Recusado" data-linha="${c.linha}" ${isRec}>
                <label for="${grp}_n">‚ùå N√£o vou</label>
              </div>
            </div>`;
        });
        document.getElementById('nomesContainer').innerHTML = html;
        document.getElementById('conteudo-ativo').style.display = 'none';
        document.getElementById('listaConvidados').style.display = 'flex';
        alertMsg("");
      }

      function enviarConfirmacao() {
        var btn = document.getElementById('btnConfirmar');
        btn.disabled = true; btn.innerText = "SALVANDO...";
        mostrarLoading(true, "Salvando respostas...");
        var respostas = [];
        document.querySelectorAll('#nomesContainer input:checked').forEach(input => {
          respostas.push({ linha: parseInt(input.dataset.linha), status: input.value });
        });
        
        enviarDados('atualizar', { respostas: respostas })
          .then(res => sucessoEnvio(res))
          .catch(e => tratarErro(e));
      }

      function sucessoEnvio(r) {
        mostrarLoading(false);
        if(r.error) { tratarErro(new Error(r.error)); return; }
        document.getElementById('listaConvidados').style.display = 'none';
        document.getElementById('telaSucesso').style.display = 'flex';
        alertMsg("");
      }

      function tratarErro(e) {
        mostrarLoading(false);
        document.getElementById('btnBuscar').disabled = false;
        var btnConf = document.getElementById('btnConfirmar');
        if(btnConf) { btnConf.disabled = false; btnConf.innerText = "SALVAR CONFIRMA√á√ÉO"; }
        alertMsg("‚ö†Ô∏è " + (e.message || "Erro"), true);
      }

      function alertMsg(msg, erro=false) {
        var div = document.getElementById('mensagem');
        if(!msg) { div.style.display = 'none'; return; }
        div.style.display = 'block'; div.innerText = msg;
        div.style.backgroundColor = erro ? '#ffdddd' : '#ddffdd';
        div.style.color = erro ? '#a00' : '#0a0';
      }

      function mostrarLoading(show, txt) {
        var div = document.getElementById('loading');
        div.style.display = show ? 'block' : 'none';
        if(txt) div.innerText = txt;
      }

      function reiniciar(e) {
        e.preventDefault();
        document.getElementById('codigoInput').value = "";
        var btnConf = document.getElementById('btnConfirmar');
        if(btnConf) { btnConf.disabled = false; btnConf.innerText = "SALVAR CONFIRMA√á√ÉO"; }
        document.getElementById('telaSucesso').style.display = 'none';
        document.getElementById('conteudo-ativo').style.display = 'flex';
        alertMsg(""); 
      }
    </script>
  </body>
</html>
