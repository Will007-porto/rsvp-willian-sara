<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Willian & Sara | Confirma√ß√£o</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
      :root {
        --cor-primaria: #0A4F3A; 
        --cor-recusar: #D93025;
        --bg-card: rgba(255, 255, 255, 0.95);
      }
      * { box-sizing: border-box; }
      body {
        font-family: 'Montserrat', sans-serif; margin: 0; padding: 20px;
        color: #FFF; display: flex; align-items: center; justify-content: center;
        min-height: 100vh; 
        background-image: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('https://i.imgur.com/8Sq1suX.jpeg');
        background-size: cover; background-position: center; background-attachment: fixed;
      }
      #app {
        width: 100%; max-width: 450px;
        background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(5px);
        padding: 25px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.2);
        display: flex; flex-direction: column; height: 85vh;
      }
      @media (max-width: 480px) {
        body { padding: 0; }
        #app { border-radius: 0; height: 100dvh; padding: 20px; background: rgba(0,0,0,0.4); border:none; }
      }
      
      h1 { text-align: center; margin: 0 0 5px; font-size: 26px; }
      .sub { text-align: center; font-size: 13px; margin-bottom: 20px; text-transform: uppercase; letter-spacing: 2px; opacity: 0.9; }

      /* Inputs e Bot√µes */
      input {
        width: 100%; padding: 15px; border-radius: 8px; border: none;
        text-align: center; font-size: 18px; text-transform: uppercase; font-weight: bold;
        margin-bottom: 15px; background: rgba(255,255,255,0.9); color: #333;
      }
      button {
        width: 100%; padding: 15px; border-radius: 8px; border: none;
        background: var(--cor-primaria); color: #FFF; font-weight: bold; font-size: 16px;
        text-transform: uppercase; cursor: pointer; margin-top: auto;
      }
      button:active { transform: scale(0.98); }
      button.secondary { background: #555; margin-top: 10px; }

      /* Conte√∫do */
      #conteudo-ativo, #listaConvidados, #painelAdmin, #telaSucesso { display: flex; flex-direction: column; flex-grow: 1; overflow: hidden; }
      #listaConvidados, #painelAdmin, #telaSucesso { display: none; }
      
      #nomesContainer { overflow-y: auto; padding-right: 5px; margin-bottom: 15px; }

      /* Card Convidado */
      .convidado-item { background: var(--bg-card); padding: 15px; border-radius: 10px; margin-bottom: 10px; color: #333; }
      .nome { font-weight: bold; font-size: 16px; margin: 0 0 5px; }
      .detalhe { font-size: 12px; color: #666; margin-bottom: 8px; }
      
      .radio-group { display: flex; background: #eee; border-radius: 5px; padding: 3px; }
      .radio-group input { display: none; }
      .radio-group label { flex: 1; text-align: center; padding: 10px; font-size: 13px; font-weight: 600; cursor: pointer; border-radius: 4px; color: #555; }
      .radio-group input[value="Confirmado"]:checked + label { background: var(--cor-primaria); color: #FFF; }
      .radio-group input[value="Recusado"]:checked + label { background: var(--cor-recusar); color: #FFF; }

      /* Admin Dashboard */
      .dash-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; overflow-y: auto; padding-bottom: 10px; }
      .card-stat { background: var(--bg-card); padding: 10px; border-radius: 8px; text-align: center; color: #333; display: flex; flex-direction: column; justify-content: center; }
      .card-stat.full { grid-column: span 2; }
      .val { font-size: 24px; font-weight: 800; }
      .lbl { font-size: 10px; text-transform: uppercase; color: #666; font-weight: bold; }
      .obs { font-size: 9px; color: #888; margin-top: 2px; }

      /* Utils */
      #loading, #msg { text-align: center; margin-top: 10px; padding: 10px; border-radius: 5px; font-weight: bold; text-shadow: none; display: none; }
      #loading { background: rgba(255,255,255,0.9); color: #333; }
      
      /* Contador */
      #countdown { display: flex; justify-content: center; gap: 15px; margin-bottom: 20px; }
      .time-box { text-align: center; }
      .time-val { font-size: 26px; font-weight: bold; line-height: 1; }
      .time-lbl { font-size: 10px; text-transform: uppercase; opacity: 0.8; }
    </style>
  </head>
  <body>
    <div id="app">
      <div style="flex-shrink:0;">
        <h1>Willian & Sara</h1>
        <p class="sub">Fevereiro 2026</p>
      </div>

      <div id="conteudo-ativo">
        <div style="text-align:center; margin-bottom:10px; font-size:12px; opacity:0.8;">FALTAM:</div>
        <div id="countdown">
          <div class="time-box"><div id="d" class="time-val">00</div><div class="time-lbl">Dias</div></div>
          <div class="time-box"><div id="h" class="time-val">00</div><div class="time-lbl">Hs</div></div>
          <div class="time-box"><div id="m" class="time-val">00</div><div class="time-lbl">Min</div></div>
        </div>

        <div style="margin-top:auto; margin-bottom:auto;">
          <p style="text-align:center; font-size:14px; margin-bottom:10px;">Digite o c√≥digo do convite:</p>
          <input type="text" id="codigo" placeholder="Ex: WS-RN-02" onkeyup="this.value = this.value.toUpperCase();">
          <button id="btnBusca" onclick="buscar()">Confirmar Presen√ßa</button>
        </div>
      </div>

      <div id="listaConvidados">
        <p style="text-align:center; font-size:13px; margin-bottom:15px;">Marque a op√ß√£o para cada pessoa:</p>
        <div id="nomesContainer"></div>
        <button id="btnSalvar" onclick="salvar()">Salvar Respostas</button>
      </div>

      <div id="telaSucesso" style="text-align:center; justify-content:center;">
        <h2 style="font-size:30px;">Salvo! ‚úÖ</h2>
        <p>Obrigado por confirmar.</p>
        <br>
        <button class="secondary" onclick="location.reload()">Sair</button>
      </div>

      <div id="painelAdmin">
        <p style="text-align:center; font-weight:bold; margin-bottom:10px;">üìä Dashboard</p>
        <div class="dash-grid" id="gridAdmin">Carregando...</div>
        <button class="secondary" onclick="location.reload()">Sair</button>
      </div>

      <div id="loading">Carregando...</div>
      <div id="msg"></div>
    </div>

    <script>
      // --- SUA URL DO SCRIPT AQUI ---
      const API_URL = "https://script.google.com/macros/s/AKfycbySc_m4-r0UiREV5certyoh4uf3QA6uM4LbttTma7R9sxAG6RijzQ8VloXqRvUrgdPu/exec";
      // -------------------------------

      // Contador
      const dataCasamento = new Date(2026, 0, 11).getTime();
      setInterval(() => {
        const diff = dataCasamento - new Date().getTime();
        if(diff < 0) return;
        document.getElementById('d').innerText = Math.floor(diff / (1000*60*60*24));
        document.getElementById('h').innerText = Math.floor((diff % (1000*60*60*24)) / (1000*60*60));
        document.getElementById('m').innerText = Math.floor((diff % (1000*60*60)) / (1000*60));
      }, 1000);

      function api(action, data={}) {
        document.getElementById('loading').style.display = 'block';
        return fetch(API_URL, {
          method: 'POST', body: JSON.stringify({action, ...data})
        }).then(r => r.json()).finally(() => document.getElementById('loading').style.display = 'none');
      }

      function buscar() {
        const cod = document.getElementById('codigo').value.trim().toUpperCase();
        if(!cod) return alert("Digite o c√≥digo.");
        
        api('buscar', {codigo: cod}).then(res => {
          if(res.isAdmin) return abrirAdmin();
          if(res.error) return alert(res.error);
          
          let html = "";
          res.convidados.forEach(c => {
            const extra = [c.parentesco, c.funcao].filter(Boolean).join(" ‚Ä¢ ");
            const checkSim = c.status == 'Confirmado' ? 'checked' : '';
            const checkNao = c.status == 'Recusado' ? 'checked' : '';
            
            html += `
            <div class="convidado-item">
              <div class="nome">${c.nome}</div>
              <div class="detalhe">${extra}</div>
              <div class="radio-group">
                <input type="radio" name="rsvp_${c.linha}" id="s_${c.linha}" value="Confirmado" data-linha="${c.linha}" ${checkSim}>
                <label for="s_${c.linha}">‚úÖ Vou</label>
                <input type="radio" name="rsvp_${c.linha}" id="n_${c.linha}" value="Recusado" data-linha="${c.linha}" ${checkNao}>
                <label for="n_${c.linha}">‚ùå N√£o vou</label>
              </div>
            </div>`;
          });
          document.getElementById('nomesContainer').innerHTML = html;
          document.getElementById('conteudo-ativo').style.display = 'none';
          document.getElementById('listaConvidados').style.display = 'flex';
        });
      }

      function salvar() {
        const respostas = [];
        document.querySelectorAll('input[type=radio]:checked').forEach(el => {
          respostas.push({ linha: el.dataset.linha, status: el.value });
        });
        api('atualizar', {respostas}).then(res => {
          document.getElementById('listaConvidados').style.display = 'none';
          document.getElementById('telaSucesso').style.display = 'flex';
        });
      }

      function abrirAdmin() {
        document.getElementById('conteudo-ativo').style.display = 'none';
        document.getElementById('painelAdmin').style.display = 'flex';
        api('dashboard').then(d => {
          document.getElementById('gridAdmin').innerHTML = `
            <div class="card-stat full"><div class="val">${d.total}</div><div class="lbl">Total Lista</div></div>
            <div class="card-stat"><div class="val" style="color:#0A4F3A">${d.confirmados}</div><div class="lbl">Confirmados</div></div>
            <div class="card-stat"><div class="val" style="color:#D93025">${d.recusados}</div><div class="lbl">Recusados</div></div>
            <div class="card-stat"><div class="val">${d.pendentes}</div><div class="lbl">Pendentes Total</div></div>
            <div class="card-stat" style="border:1px solid #0056b3">
               <div class="val" style="color:#0056b3">${d.entreguesPendentes}</div>
               <div class="lbl">Receberam s/ Resp.</div>
               <div class="obs">Col K = "s"</div>
            </div>
            <div class="card-stat"><div class="val">${d.willian}</div><div class="lbl">Conv. Willian</div></div>
            <div class="card-stat"><div class="val">${d.sara}</div><div class="lbl">Conv. Sara</div></div>
            <div class="card-stat"><div class="val">${d.ambos}</div><div class="lbl">Conv. Ambos</div></div>
          `;
        });
      }
    </script>
  </body>
</html>
